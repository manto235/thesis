\chapter{Protocoles et mécanismes d'Internet}

\section{Présentation du protocole HTTP}
\label{http-expl}
HTTP (HyperText Transport Protocol) \cite{Obo_CNP3} est un protocole qui fournit les fondations du World Wide Web, il repose sur le modèle client-serveur dans lequel le client envoie une requête et le serveur retourne une réponse.
\newline

Les requêtes HTTP se composent de trois parties :
\begin{enumerate}
	\item Une ligne de requête (qui contient notamment une URI)
	\item Un en-tête (qui contient des paramètres facultatifs pour la requête)
	\item Le corps de la requête (optionnel)
	\newline
\end{enumerate}

Lorsqu'un utilisateur clique sur un lien hypertexte via son navigateur, celui-ci se connecte à un serveur identifié par l'URI "Uniform Resource Identifier" présente dans ce lien. Le navigateur envoie alors une requête à laquelle le serveur répond puis le navigateur se déconnecte du serveur.
L'on considère que la requête est sans état car à chaque fois que le navigateur crée une connexion pour une requête, le serveur la traite comme si c'était la première ; les requêtes sont donc indépendantes.
\newline

Les réponses HTTP se composent également de trois parties :
\begin{enumerate}
	\item Une ligne de statut (qui indique si la requête est réussie ou pas)
	\item Un en-tête (qui contient des informations additionnelles sur la réponse)
	\item Le corps de la réponse
	\newline
\end{enumerate}

Il fallait trouver une solution afin d'avoir la possibilité de garder une certaine quantité d'informations entre des requêtes successives. Une première solution était de forcer l'authentification du client (comme pour FTP), cependant ce n'est pas toujours nécessaire ou applicable sur tous les sites web. Une seconde solution était d'utiliser les différents types d'en-têtes \emph{Accept-*}, mais cela fournit des possibilités assez limitées. Une autre solution, qui est la plus largement adoptée, est l'utilisation d'un cookie HTTP.
\newline

Des exemples de requête et réponse HTTP sont disponibles dans la \hyperref[http-request-example]{section Cookies}.

	
\section{Cookies}
\label{http-cookies-expl}
La première description sur les cookies a été publiée sur le site web de Netscape Communications mais cette description était informelle. Le processus de standardisation des cookies a commencé en avril 1995 sur la liste de diffusion [www-talk], ensuite, l'IETF (Internet Engineering Task Force) a entrepris d'écrire un standard pour les cookies \cite{Kristol:2001:HCS:502152.502153}.
C'est ainsi que la première RFC (RFC 2109) sur les cookies est parue en février 1997 \cite{IETF_RFC2109}, rendue obsolète en octobre 2000 par la RFC 2965 \cite{IETF_RFC2965}. Elle a également été rendue obsolète par la dernière RFC qui est toujours d'application en ce jour, la RFC 6265 (avril 2011) \cite{IETF_RFC6265}.
\newline

Un cookie est un petit fichier stocké en clair sur le disque dur de l'utilisateur par le navigateur. Il fait le lien entre la session de l'utilisateur et les données enregistrées par le site web (dans une base de données par exemple). Les cookies sont transmis dans les en-têtes des requêtes et des réponses HTTP \cite{IETF_RFC6265}.

Dans sa réponse à une requête, un serveur peut envoyer des informations arbitraires (le cookie) dans un en-tête \textit{Set-Cookie}. Cette information peut contenir n'importe quoi et c'est elle qui permet au serveur de continuer là où il en était. Il peut s'agir d'un identifiant relatif à l'utilisateur, une clé dans une base de données,...

Le serveur peut ajouter des attributs afin de configurer les cookies (sections 5.2.1 à 5.2.6 de la RFC 6265) :
\begin{itemize}
	\item Expires et Max-Age : date d'expiration
	\item Domain : domaine
	\item Path : chemin
	\item Secure et HttpOnly : type de connexion
	\newline
\end{itemize}

Habituellement, le client est coopératif et renvoie l'information du cookie qui est stocké par le navigateur. Dans chaque requête ultérieure qu'il fait vers le serveur, le client indique cette information dans un en-tête \textit{Cookie}. Le serveur peut choisir de renvoyer un nouveau cookie dans ses réponses, ce qui remplacera automatiquement l'ancien cookie.
\newline

Il y a un contrat implicite entre le client et le serveur : ce dernier repose sur le client afin de sauvegarder son état et il espère qu'il lui sera retourné lors de la prochaine requête.
Un cookie est donc une donnée que le serveur et le client se renvoient l'un et l'autre. La quantité d'informations est généralement petite et son contenu est à la discrétion du serveur. En effet, la plupart du temps, analyser le contenu du cookie ne révèle ni à quoi il est destiné ni la valeur qu'il représente.
%\newline

%\phantomsection
\newpage
\subsection{Exemples de requête et réponse HTTP avec cookie}
\label{http-request-example}
Voici une requête HTTP vers le site web \textit{distrowatch.com} :
\lstinputlisting{examples/http_request1_distrowatch}
Note : aucune visite vers ce site n'a été faite auparavant.
\newline

Et la réponse HTTP associée :
\lstinputlisting{examples/http_response1_distrowatch}
A la ligne 9, l'on peut voir un en-tête \textit{Set-Cookie}.\\
Un cookie dont le nom est \textit{"NewLastSeen"} est donc créé avec la valeur 8407.\\
Lors d'une prochaine visite sur le site, ce cookie sera alors renvoyé automatiquement dans la requête HTTP par le navigateur.
\newline

Voici maintenant une seconde requête vers le même site lors de la même session.
L'on peut remarquer que le navigateur envoie le cookie enregistré précédemment: la requête HTTP contient maintenant un en-tête \textit{Cookie} visible à la ligne 7 :
\lstinputlisting{examples/http_request2_distrowatch}

Quant à la réponse HTTP, elle reste identique.
\newline

Dans la seconde requête, l'on peut voir que le navigateur envoie 5 cookies alors qu'un seul n'a été enregistré via la réponse HTTP analysée auparavant.\\
Ceci s'explique par le fait que les cookies \textit{\_\_utmX} proviennent de Google Analytics \cite{Google_Analytics_cookies} et servent à analyser la navigation des visiteurs du site.
\newline

Il n'est pas nécessaire d'analyser les requêtes échangées pour voir les cookies envoyés : si l'on regarde dans les préférences du navigateur, on peut remarquer que 4 cookies sont présents pour le site \textit{distrowatch.com} (\autoref{cookies_distrowatch}).
Le cookie \_\_utmc n'apparaît plus car il a été supprimé à la fin de sa session de navigation (suite à sa date d'expiration) alors que la capture d'écran a été effectuée lors d'une session ultérieure.

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.75]{figures/cookies_distrowatch.png}
	\caption{\label{cookies_distrowatch}Les cookies enregistrés pour le site \textit{distrowatch.com} dans Firefox.}
\end{figure}

\section{Cache}
\label{http-cache-expl}
Dans le domaine informatique, un cache permet de garder une copie locale d'un élément afin de répondre rapidement à une requête. Au lieu de récupérer l'élément, le cache renvoie sa copie, ce qui permet de réduire sensiblement le temps de réponse.\\
Sur Internet, plusieurs mécanismes de cache ont été implémentés \cite{WikipediaEN_Web_cache}. Ils peuvent par exemple être installés à différents niveaux:

\begin{itemize}
  \item sur le réseau qui délivre le contenu d'un site web (ex. : un CDN - "Content Delivery Network")
  \item sur l'application qui gère et affiche le contenu d'un site web (ex. : un CMS - "Content Management System")
  \item sur le serveur qui héberge le site web (ex. : Apache)
  \item via le navigateur Web du client qui stocke les fichiers sur le disque dur
  \newline
\end{itemize}

Lorsque que l'on navigue sur Internet, le cache du navigateur enregistre certaines ressources (images, feuilles de style, fichiers JavaScript, etc.) afin de ne pas devoir les recharger depuis le serveur lors des visites ultérieures. Par ailleurs, il est possible pour les administrateurs d'un site web de paramétrer et de limiter la mise en cache de certaines pages grâce à l'en-tête \textit{Cache-Control}.


\section{Comment le Web est-il censé fonctionner ?}
\label{web-expl}
Lors du chargement d'une page web, le navigateur effectue de multiples connexions afin de récupérer l'ensemble des ressources de la page. Aux débuts du World Wide Web, toutes les ressources d'une page appartenaient généralement à une même personne/groupe. A l'heure actuelle, la situation a fort changé : il est fréquent de voir des ressources chargées depuis des domaines tiers (régies publicitaires, CDN,...). Le navigateur effectue donc des connexions vers des serveurs différents (cela permet notamment de passer outre la limitation du nombre de connexions HTTP vers un même domaine \cite{IETF_RFC2616}) mais en contrepartie, cela permet aux serveurs en question d'enregistrer des données sur le client suite aux requêtes qu'il effectue.
\newline

Lors du développement de Netscape Navigator 2, une décision importante a été prise concernant le principe de même origine ("same-origin" principle) \cite{Jackson:2006:PBS:1135777.1135884}. Celui-ci interdit des sites web de domaines différents d'interagir entre eux au niveau du cache du navigateur, sauf dans des cas précis. Ce principe est implémenté dans les différents navigateurs mais il n'est appliqué de la même manière. L'échec de l'adaptation de ce principe semble être la source la plus importante de fuites de données.
